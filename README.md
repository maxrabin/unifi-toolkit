# UI Toolkit

A comprehensive suite of tools for UniFi network management and monitoring.

> **Note:** This project is not affiliated with, endorsed by, or sponsored by Ubiquiti Inc. UniFi is a trademark of Ubiquiti Inc.

## Features

### Dashboard
Real-time system status including:
- **Gateway Info** - Model, firmware, uptime
- **Resource Usage** - CPU and RAM utilization
- **Network Health** - WAN, LAN, WLAN, VPN status with diagnostic reasons
- **Connected Clients** - Wired and wireless counts
- **WAN Status** - IP, ISP, latency, uptime (supports multi-WAN)
- **Speedtest** - On-demand speed testing (where supported)

### Wi-Fi Stalker
Track specific Wi-Fi client devices through your UniFi infrastructure.
- Device tracking by MAC address
- Roaming detection between access points
- Connection history with timestamps
- Webhook alerts (Slack, Discord, n8n)

### Threat Watch
Monitor IDS/IPS security events from your UniFi gateway.
- Real-time event monitoring
- Threat categorization and analysis
- Top attackers and targets
- Webhook alerts (Slack, Discord, n8n)

### UI Product Selector *(External)*
Build the perfect UniFi network at [uiproductselector.com](https://uiproductselector.com)

---

## Quick Start

### Requirements
- **Docker** (recommended) or Python 3.9-3.12
- **Ubuntu 22.04/24.04** (or other Linux)
- Access to UniFi Controller

### Local Deployment (LAN Only)

No authentication, access via `http://localhost:8000`

```bash
# Install Docker
sudo apt update && sudo apt install -y docker.io docker-compose
sudo usermod -aG docker $USER && newgrp docker

# Clone and setup
git clone https://github.com/CrosstalkSolutions/unifi-toolkit.git
cd unifi-toolkit
./setup.sh  # Select 1 for Local

# Start
docker-compose up -d
```

Access at **http://localhost:8000**

### Production Deployment (Internet-Facing)

Authentication enabled, HTTPS with Let's Encrypt via Caddy

```bash
# Install Docker
sudo apt update && sudo apt install -y docker.io docker-compose
sudo usermod -aG docker $USER && newgrp docker

# Clone and setup
git clone https://github.com/CrosstalkSolutions/unifi-toolkit.git
cd unifi-toolkit
./setup.sh  # Select 2 for Production
# Enter: domain name, admin username, password

# Open firewall ports
sudo ufw allow 80/tcp && sudo ufw allow 443/tcp

# Start with HTTPS
docker-compose --profile production up -d
```

Access at **https://your-domain.com**

---

## Documentation

| Guide | Description |
|-------|-------------|
| [INSTALLATION.md](docs/INSTALLATION.md) | Complete installation guide with troubleshooting |
| [QUICKSTART.md](docs/QUICKSTART.md) | 5-minute quick start reference |
| [MIGRATION.md](docs/MIGRATION.md) | Migrating from standalone Wi-Fi Stalker |

---

## Common Commands

| Action | Command |
|--------|---------|
| Start (local) | `docker-compose up -d` |
| Start (production) | `docker-compose --profile production up -d` |
| Stop | `docker-compose down` |
| View logs | `docker-compose logs -f` |
| Restart | `docker-compose restart` |
| Reset password | `./reset_password.sh` |
| Update | `git pull && docker-compose build && docker-compose up -d` |

---

## Configuration

### Setup Wizard (Recommended)

Run the interactive setup wizard:

```bash
./setup.sh
```

The wizard will:
- Generate encryption key
- Configure deployment mode (local/production)
- Set up authentication (production only)
- Create your `.env` file

### Manual Configuration

Copy and edit the example configuration:

```bash
cp .env.example .env
```

#### Required Settings

| Variable | Description |
|----------|-------------|
| `ENCRYPTION_KEY` | Encrypts stored credentials (auto-generated by setup wizard) |

#### Deployment Settings (Production Only)

| Variable | Description |
|----------|-------------|
| `DEPLOYMENT_TYPE` | `local` or `production` |
| `DOMAIN` | Your domain name (e.g., `toolkit.example.com`) |
| `AUTH_USERNAME` | Admin username |
| `AUTH_PASSWORD_HASH` | Bcrypt password hash (generated by setup wizard) |

#### UniFi Controller Settings

Configure via `.env` or the web UI (web UI takes precedence):

| Variable | Description |
|----------|-------------|
| `UNIFI_CONTROLLER_URL` | Controller URL (e.g., `https://192.168.1.1`) |
| `UNIFI_USERNAME` | Username (legacy controllers) |
| `UNIFI_PASSWORD` | Password (legacy controllers) |
| `UNIFI_API_KEY` | API key (UniFi OS: UDM, UCG, Cloud Key) |
| `UNIFI_SITE_ID` | Site ID (default: `default`) |
| `UNIFI_VERIFY_SSL` | SSL verification (default: `false`) |

#### Tool Settings

| Variable | Description |
|----------|-------------|
| `STALKER_REFRESH_INTERVAL` | Device refresh interval in seconds (default: `60`) |

---

## Security

### Authentication

- **Local mode**: No authentication (trusted LAN only)
- **Production mode**: Session-based authentication with bcrypt password hashing
- **Rate limiting**: 5 failed login attempts = 5 minute lockout

### HTTPS

Production deployments use Caddy for automatic HTTPS:
- Let's Encrypt certificates (auto-renewed)
- HTTP to HTTPS redirect
- Security headers (HSTS, X-Frame-Options, etc.)

### Multi-Site Networking

When managing multiple UniFi sites, always use site-to-site VPN:

```
✅ RECOMMENDED: VPN Connection
┌──────────────────┐         ┌──────────────────┐
│  UI Toolkit      │◄──VPN──►│  Remote UniFi    │
│  Server          │         │  Controller      │
└──────────────────┘         └──────────────────┘

❌ AVOID: Direct Internet Exposure
Never expose UniFi controllers via port forwarding
```

**VPN Options:** UniFi Site-to-Site, WireGuard, Tailscale, IPSec

---

## Troubleshooting

### Can't connect to UniFi controller
- Set `UNIFI_VERIFY_SSL=false` for self-signed certificates
- UniFi OS devices (UDM, UCG) require an API key, not username/password
- Verify network connectivity to controller

### Device not showing as online
- Wait 60 seconds for the next refresh cycle
- Verify MAC address format is correct
- Confirm device is connected in UniFi dashboard

### Let's Encrypt certificate fails
- Verify DNS A record points to your server
- Ensure ports 80 and 443 are open
- Check Caddy logs: `docker-compose logs caddy`

### Rate limited on login
- Wait 5 minutes for lockout to expire
- Use `./reset_password.sh` if you forgot your password

### Docker issues
- Verify `.env` exists and contains `ENCRYPTION_KEY`
- Check logs: `docker-compose logs -f`
- Rebuild: `docker-compose build && docker-compose up -d`

---

## Running with Python (Alternative to Docker)

```bash
# Clone repository
git clone https://github.com/CrosstalkSolutions/unifi-toolkit.git
cd unifi-toolkit

# Create virtual environment (Python 3.9-3.12 only, NOT 3.13+)
python3 -m venv venv
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Run setup wizard
./setup.sh

# Start application
python run.py
```

---

## Project Structure

```
unifi-toolkit/
├── app/                    # Main application
│   ├── main.py            # FastAPI entry point
│   ├── routers/           # API routes (auth)
│   ├── static/            # CSS, images
│   └── templates/         # HTML templates
├── tools/                 # Individual tools
│   ├── wifi_stalker/      # Wi-Fi Stalker tool
│   └── threat_watch/      # Threat Watch tool
├── shared/                # Shared infrastructure
│   ├── config.py          # Settings management
│   ├── database.py        # SQLAlchemy setup
│   ├── unifi_client.py    # UniFi API wrapper
│   └── crypto.py          # Credential encryption
├── docs/                  # Documentation
├── data/                  # Database (created at runtime)
├── setup.sh               # Setup wizard
├── reset_password.sh      # Password reset utility
├── Caddyfile              # Reverse proxy config
├── docker-compose.yml     # Docker configuration
└── requirements.txt       # Python dependencies
```

---

## Support

- **Issues**: [GitHub Issues](https://github.com/CrosstalkSolutions/unifi-toolkit/issues)
- **Documentation**: [docs/](docs/)

---

## Credits

Developed by [Crosstalk Solutions](https://www.crosstalksolutions.com/)

- YouTube: [@CrosstalkSolutions](https://www.youtube.com/@CrosstalkSolutions)

---

## License

MIT License
